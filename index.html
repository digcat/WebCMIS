<html>
<!--
    WebCMIS - a pure HTML/JavaScript solution for accessing CMIS repositories.
    Copyright (C) 2013 Nicolas Raoul

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<head>
<title>WebCMIS</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="json2html.js"></script>
<script type="text/javascript" src="jquery.json2html.js"></script>
<script>
/* ---------------------------------------- Settings ------------------------------------------------ */
  var endpoint = "http://cmis.alfresco.com/cmisbrowser";
  var repository = "bb212ecb-122d-47ea-b5c1-128affb9cd8f";
  var initialFolder = "/Data Dictionary";
/* -------------------------------------------------------------------------------------------------- */
</script>
</head>
<body>

<!-- Header -->
<h1><img src="logo.png" alt="WebCMIS"/> <script>document.write(initialFolder);</script></h1>

<!-- List of CMIS objects -->
<ul>Loading from CMIS server, please wait...</ul>

<!-- Text area showing the raw JSONP data -->
<a id="details" href="#" style="display:none">Details...</a>
<textarea rows="10" cols="100" style="display:none"></textarea>

<p style="font-style:italic;font-size:75%;color:silver"><a href="https://github.com/nicolas-raoul/WebCMIS">WebCMIS</a> is a pure HTML/JavaScript client for CMIS repositories. Copyright <a href="http://CmisSync.com">Nicolas Raoul</a> 2013, Open Source. Tested with Alfresco, feedback welcome: nicolas.raoul@aegif.jp<br/>
TODO: Paging, search, upload, file edition, recent changes, object history, thumbnails/icons, check-in/check-out, ACL/policies management, customizable CSS.</p>

<script>
function navigate(folder) {
$.getJSON(
    endpoint + "/" + repository + "/root" + folder + "?succinct=true&callback=?",
    function(data){
        // Handle JSONP response.
        $("textarea").text(JSON.stringify(data, null, "\t"));
        
        // json2html template.
        var transform = [{
            "tag":"li",
            "html":function(){
                var name = this.object.succinctProperties["cmis:name"];
                var type = this.object.succinctProperties["cmis:objectTypeId"];
                var size = this.object.succinctProperties["cmis:contentStreamLength"];
                if (size == undefined) {
                    return "<a href='javascript:navigate(\"" + folder + "/" + name + "\")'>" + name + "</a> <span style='color:silver'>[" + type + "]</span>";
                }
                else {
                    var downloadURL = endpoint + "/" + repository + "/root" + folder + "/" + name;
                    return "<a href='" + downloadURL + "'>" + name + "</a> <span style='color:silver'>[" + type + ", " + size + " bytes]</span>";
                }
            }
        }];
        
        // Update view.
        $("ul").html("");
        $("ul").json2html(data.objects, transform);
        $("a").show();
    }
);
}
$(document).ready(function(){
  $("#details").click(function(){
    $("textarea").show();
    $("#details").hide();
  });
});
navigate(initialFolder);
</script>

</body>
</html>
